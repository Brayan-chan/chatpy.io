<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>chatpy.io</title>
    <link rel="stylesheet" href="../static/styles.css">
</head>

<body>
    <div class="chat-container">
        <nav class="nav-sidebar">
            <div class="nav-top">
                <div class="nav-icon action-button">
                    <i class="fas fa-comment"></i>
                </div>
                <div class="unread-total">6</div>
            </div>
            <div class="nav-bottom">
                <div class="nav-icon action-button">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="user-avatar">
                    <img src="https://media-mia3-1.cdn.whatsapp.net/v/t61.24694-24/461338513_543649241643596_1140871026957553677_n.jpg?ccb=11-4&oh=01_Q5AaIDUIt2ARpZvXBf1kgVemO0mwXtykj8ZxR0YDgFMIlL_S&oe=67AC9A42&_nc_sid=5e03e0&_nc_cat=108"
                        alt="TÃº">
                </div>
            </div>
        </nav>

        <aside class="chat-sidebar">
            <div class="sidebar-header">
                <h1>Chats</h1>
                <div class="header-icons">
                    <button class="action-button">
                        <i class="fas fa-user-plus"></i>
                    </button>
                    <button class="action-button">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>

            <div class="search-container">
                <i class="search-icon fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Buscar">
            </div>

            <div class="filter-buttons">
                <button class="filter-button">Todos</button>
                <button class="filter-button">No leÃ­dos</button>
            </div>

            <div class="chat-list">
                <div class="chat-item">
                    <div class="avatar">
                        <img src="https://media-mia3-1.cdn.whatsapp.net/v/t61.24694-24/473400983_937214201872149_888653449431714886_n.jpg?ccb=11-4&oh=01_Q5AaIKJDHgQXNi1AsuEgYc9hfxU4NxtyO4wBJG57nyDb_E33&oe=67AAC1D7&_nc_sid=5e03e0&_nc_cat=111"
                            alt="Grupo">
                    </div>
                    <div class="chat-name">Sistemas Distribuidos</div>
                    <div class="chat-info"><span>TÃº: </span>Este es mi primer men...</div>
                    <div class="chat-time">7:30 p.m.</div>
                    <div class="unread-badge">2</div>
                </div>
            </div>
        </aside>

        <main class="chat-main">
            <header class="chat-header">
                <div class="header-left">
                    <div class="avatar">
                        <img src="https://media-mia3-1.cdn.whatsapp.net/v/t61.24694-24/473400983_937214201872149_888653449431714886_n.jpg?ccb=11-4&oh=01_Q5AaIKJDHgQXNi1AsuEgYc9hfxU4NxtyO4wBJG57nyDb_E33&oe=67AAC1D7&_nc_sid=5e03e0&_nc_cat=111"
                            alt="Grupo">
                    </div>
                    <div>
                        <h2>Sistemas Distribuidos</h2>
                        <div style="color: #8f8f8f">Josue, Robert, TÃº...</div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="action-button">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="action-button">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </header>

            <div class="messages-container">
                <div class="message-group josue">
                    <div class="avatar">
                        <img src="https://images.pexels.com/photos/5054346/pexels-photo-5054346.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
                            alt="Josue">
                    </div>
                    <div class="message received">
                        <strong>Josue</strong>
                        <p>Este es el primer mensaje de Josue ðŸš€</p>
                        <div class="message-time">7:30 p.m.</div>
                    </div>
                </div>

                <div class="message-group josue">
                    <div class="avatar">
                        <img src="https://images.pexels.com/photos/5054346/pexels-photo-5054346.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
                            alt="Josue">
                    </div>
                    <div class="message received">
                        <strong>Josue</strong>
                        <p>Este es el segundo mensaje de Josue ðŸš€</p>
                        <div class="message-time">7:31 p.m.</div>
                    </div>
                </div>

                <div class="message-group robert">
                    <div class="avatar">
                        <img src="https://images.pexels.com/photos/4792716/pexels-photo-4792716.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
                            alt="Robert">
                    </div>
                    <div class="message received">
                        <strong>Robert</strong>
                        <p>Este es el primer mensaje de Robert âœ¨</p>
                        <div class="message-time">7:33 p.m.</div>
                    </div>
                </div>

                <div class="message-group robert">
                    <div class="avatar">
                        <img src="https://images.pexels.com/photos/4792716/pexels-photo-4792716.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
                            alt="Robert">
                    </div>
                    <div class="message received">
                        <strong>Robert</strong>
                        <p>Este es el segundo mensaje de Robert ðŸ”¥</p>
                        <div class="message-time">8:00 p.m.</div>
                    </div>
                </div>

                <div class="message sent">
                    <p>Este es mi primer mensaje de prueba â˜•</p>
                    <div class="message-time">7:00 a.m.</div>
                </div>
            </div>

            <div class="message-input-container">
                <button class="action-button">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="action-button" id="emoji-button">
                    <i class="fas fa-smile"></i>
                </button>
                <div class="message-input-wrapper">
                    <input type="text" class="message-input" id="message-input" placeholder="Escribe un mensaje">
                </div>
                <button class="action-button" id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button class="action-button" id="mic-button">
                    <i class="fas fa-microphone"></i>
                </button>
            </div>
        </main>
    </div>

    <template id="message-template-sent">
        <div class="message sent">
            <p></p>
            <div class="message-time"></div>
        </div>
    </template>

    <template id="message-template-received">
        <div class="message-group">
            <div class="avatar"></div>
            <div class="message received">
                <strong></strong>
                <p></p>
                <div class="message-time"></div>
            </div>
        </div>
    </template>

    <script>
        document.getElementById('send-button').addEventListener('click', function () {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;
            if (message.trim() !== '') {
                fetch('/send_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nombre: 'Tu Nombre',
                        contenido: message
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            messageInput.value = '';
                            addMessageToChat('Tu Nombre', message, 'sent');
                        } else {
                            console.error('Error:', data.message);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });

        document.getElementById('emoji-button').addEventListener('click', function () {
            const messageInput = document.getElementById('message-input');
            messageInput.value += 'ðŸ˜Š';
        });

        function addMessageToChat(nombre, contenido, tipo = 'received') {
            const templateId = tipo === 'sent' ? 'message-template-sent' : 'message-template-received';
            const template = document.getElementById(templateId).content.cloneNode(true);
            if (tipo === 'received') {
                template.querySelector('strong').textContent = nombre;
            }
            template.querySelector('p').textContent = contenido;
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            template.querySelector('.message-time').textContent = timeString;
            document.querySelector('.messages-container').appendChild(template);
        }
    </script>
</body>

</html>